# ---------- BUILD STAGE ----------
FROM maven:3.9.9-eclipse-temurin-17 AS build

# Work inside /app
WORKDIR /app

# Copy the backend Maven project
COPY backend/pom.xml .
COPY backend/src ./src

# Build the backend (downloads deps + compiles)
RUN mvn -q -DskipTests package

# ---------- RUNTIME STAGE ----------
FROM eclipse-temurin:17-jre

WORKDIR /app

# Copy compiled classes and Maven repo from the build image
COPY --from=build /app/target/classes ./classes
COPY --from=build /root/.m2 /root/.m2

# Expose the port your EmbeddedServer uses (8080 in your code)
EXPOSE 8080

# Run the server
# (Adjust main class if your package name is different)
CMD ["java", "-cp", "classes:/root/.m2/repository/*", "EmbeddedServer"]
